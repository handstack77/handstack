const LicenseManager = require('./license-manager');

// 라이선스 매니저 생성
const manager = new LicenseManager();

function createExampleLicensesWithJS() {
    console.log('=== JavaScript 라이선스 파일 생성 예제 ===\n');
    console.log(`Current UTC Time: 2025-07-01 23:57:48`);
    console.log(`User: handstack\n`);

    // 1. 개발용 라이선스
    const devLicense = manager.addLicense({
        moduleId: 'handstack-ui-dev',
        companyName: 'HandStack',
        productName: 'HandStackUI-v1.0.0-DEV001',
        authorizedHosts: ['handstack.kr', 'www.handstack.kr'],
        environment: 'Development',
        expiresAt: null
    });

    // 2. 상용 라이선스
    const prodLicense = manager.addLicense({
        moduleId: 'handstack-ui-prod',
        companyName: 'HandStack',
        productName: 'HandStackUI-v1.0.0-PROD001',
        authorizedHosts: ['handstack.kr', 'www.handstack.kr'],
        environment: 'Production',
        expiresAt: '2026-07-01T23:59:59.000Z'
    });

    // 3. API 라이선스
    const apiLicense = manager.addLicense({
        moduleId: 'custom-api-module',
        companyName: 'HandStack',
        productName: 'CustomApiModule-v1.0.0-PROD001',
        authorizedHosts: ['handstack.kr', 'www.handstack.kr'],
        environment: 'Production',
        expiresAt: '2025-12-31T23:59:59.000Z'
    });

    console.log('\n=== JavaScript 파일 생성 ===\n');

    // 개별 JavaScript 파일 생성
    try {
        // 일반 버전
        const jsResult1 = manager.generateJavaScriptLicense('handstack-ui-dev', {
            minify: false,
            outputDir: './generated-licenses'
        });
        
        console.log(`Generated: ${jsResult1.fileName}`);
        console.log(`   Content Preview:`);
        console.log(`   ${jsResult1.fileContent.split('\n').slice(0, 8).join('\n')}...`);
        console.log('');

        // 압축 버전
        const jsResult2 = manager.generateJavaScriptLicense('handstack-ui-prod', {
            minify: true,
            outputDir: './generated-licenses',
            fileSuffix: 'License.min'
        });
        
        console.log(`Generated (minified): ${jsResult2.fileName}`);
        console.log(`   Size: ${jsResult2.fileSize} bytes`);
        console.log('');

        // 모든 라이선스에 대해 생성
        console.log('Generating all JavaScript files...\n');
        const allResults = manager.generateAllJavaScriptLicenses({
            minify: false,
            outputDir: './generated-licenses',
            addTimestamp: true
        });

        // 결과 요약
        const successful = allResults.filter(r => r.success).length;
        const failed = allResults.filter(r => !r.success).length;
        
        console.log(`Generation Summary:`);
        console.log(`   Total: ${allResults.length}`);
        console.log(`   Successful: ${successful}`);
        console.log(`   Failed: ${failed}`);

    } catch (error) {
        console.error('JavaScript generation error:', error.message);
    }

    return { devLicense, prodLicense, apiLicense };
}

// 생성된 파일 내용 예시 출력
function showGeneratedFileExamples() {
    console.log('\n=== 생성된 파일 예시 ===\n');

    // handstack-ui-dev 예시
    console.log('handstackUiDevLicense.js:');
    console.log(`/*!
 * Product ID: HandStackUI-v1.0.0-DEV001
 * Authorized Domain(or IP): dev.handstack.kr,localhost
 * Publisher: handstack.kr
 * Generated: 2025-07-01 23:57:48 UTC
 * Generated By: handstack
 * Module ID: handstack-ui-dev
 * Environment: Development
 */
/* eslint-disable */
var handstackUiDevLicense = "[EncryptedKey].[SignatureKey]";
if (typeof window !== "undefined") window.handstackUiDevLicense = handstackUiDevLicense;`);

    console.log('\ncustomApiModuleLicense.js:');
    console.log(`/*!
 * Product ID: CustomAPI-v2.1.5-STARTUP001
 * Authorized Domain(or IP): api.techstartup.io,*.techstartup.io,192.168.1.100
 * Publisher: handstack.kr
 * Generated: 2025-07-01 23:57:48 UTC
 * Generated By: handstack
 * Module ID: custom-api-module
 * Environment: Production
 * Expires: 2025-12-31T23:59:59.000Z
 */
/* eslint-disable */
var customApiModuleLicense = "[EncryptedKey].[SignatureKey]";
if (typeof window !== "undefined") window.customApiModuleLicense = customApiModuleLicense;`);
}

// 실행
async function main() {
    try {
        console.log('HandStackCorp JavaScript License Generator\n');
        
        // 라이선스 생성 및 JavaScript 파일 생성
        createExampleLicensesWithJS();
        
        // 파일 예시 출력
        showGeneratedFileExamples();
        
        // 파일 저장
        const savedPath = manager.saveToFile('licenses-with-js.json');
        console.log(`\nLicenses saved to: ${savedPath}`);
        
        console.log('\nAll operations completed successfully!');
        
    } catch (error) {
        console.error('Error:', error.message);
        process.exit(1);
    }
}

// 스크립트 실행
if (require.main === module) {
    main();
}

module.exports = { LicenseManager };
